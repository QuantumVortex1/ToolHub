<div class="component-wrapper">
    <h2>Ausgabenaufteilung</h2>

    <div class="people-table-container">
        <table mat-table [dataSource]="dataSource" class="people-table">
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let person">
                    <mat-form-field appearance="outline" class="small-input">
                        <input matInput [(ngModel)]="person.name" placeholder="Name eingeben..."
                            (ngModelChange)="onPersonChange(person)">
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="contributed">
                <th mat-header-cell *matHeaderCellDef>Eingebracht (€)</th>
                <td mat-cell *matCellDef="let person">
                    <mat-form-field appearance="outline" class="compact-field small-input">
                        <input matInput type="number" [(ngModel)]="person.contributed"
                            (ngModelChange)="onPersonChange(person)" min="0" step="0.01" placeholder="0.00">
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="spent">
                <th mat-header-cell *matHeaderCellDef>Ausgegeben (€)</th>
                <td mat-cell *matCellDef="let person">
                    <mat-form-field appearance="outline" class="compact-field small-input">
                        <input matInput type="number" [(ngModel)]="person.spent"
                            (ngModelChange)="onPersonChange(person)" min="0" step="0.01" placeholder="0.00">
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="settlement">
                <th mat-header-cell *matHeaderCellDef class="calculated-header highlight-header">Ausgleich</th>
                <td mat-cell *matCellDef="let person" class="calculated-cell highlight-cell">
                    <span [class]="getSettlementColor(person.settlement)">
                        {{ getSettlementText(person.settlement) }}
                    </span>
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let person" class="actions-cell">
                    <button mat-icon-button color="warn" *ngIf="isPersonComplete(person)" (click)="removePerson(person)"
                        matTooltip="Person entfernen">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.empty-row]="!isPersonComplete(row)">
            </tr>
        </table>
    </div>

    <div class="summary-section">
        <div class="actions">
            <button mat-raised-button color="primary" (click)="distributeUnallocated()"
                *ngIf="expensesData.unallocatedAmount > 0"
                matTooltip="Verteilt den nicht zugeordneten Betrag gleichmäßig auf alle Personen">
                Nicht zugeordnetes Geld ({{ expensesData.unallocatedAmount | currency: 'EUR' }}) verteilen
            </button>

            <button mat-stroked-button color="warn" (click)="resetAll()">
                <mat-icon>refresh</mat-icon>
                Zurücksetzen
            </button>
        </div>
    </div>
</div>