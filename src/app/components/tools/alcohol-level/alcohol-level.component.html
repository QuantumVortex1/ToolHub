<div class="component-wrapper">
    <h2>Promille-Rechner</h2>

    <div class="warning-box" *ngIf="showWarning">
        <span>Alkoholkonsum ist gefährlich und kann zu Sucht führen. Wenn Sie Hilfe benötigen, suchen Sie bitte
            professionelle Unterstützung. Fahren Sie nicht unter Alkoholeinfluss.</span>
        <button mat-icon-button class="close-button" aria-label="Warnung schließen" (click)="showWarning = false">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <div class="info-box" *ngIf="showInfo">
        <span>Die Berechnung des Blutalkoholspiegels (BAC) basiert auf der <a
                href="https://de.wikipedia.org/wiki/Widmark-Formel" target="_blank">Widmark-Formel</a> und nimmt einen
            Alkoholabbau von 0,15 ‰/h an. Der tatsächliche BAC kann je nach individuellen Faktoren variieren.</span>
        <button mat-icon-button class="close-button" aria-label="Info schließen" (click)="showInfo = false">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <div class="personal-values">
        <span>Persönliche Werte</span>
        <div class="personal-inputs">

            <mat-form-field appearance="outline" class="personal-field small-input">
                <mat-label>Körpergewicht (kg)</mat-label>
                <input matInput type="number" [(ngModel)]="weight" min="1" step="0.5" placeholder="70"
                    (ngModelChange)="onPersonalDataChange()">
            </mat-form-field>

            <mat-form-field appearance="outline" class="personal-field small-input">
                <mat-label>Geschlecht</mat-label>
                <mat-select [(ngModel)]="gender" (ngModelChange)="onPersonalDataChange()">
                    <mat-option value="other">Divers</mat-option>
                    <mat-option value="female">Weiblich</mat-option>
                    <mat-option value="male">Männlich</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </div>

    <div class="drinks-table-container">
        <table mat-table [dataSource]="dataSource" class="drinks-table">
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Bezeichnung</th>
                <td mat-cell *matCellDef="let drink; let i = index">
                    <mat-form-field appearance="outline" class="small-input">
                        <input matInput [(ngModel)]="drink.name" placeholder="z.B. Bier, Wein..."
                            (ngModelChange)="onDrinkChange(drink)">
                    </mat-form-field>
                </td>
            </ng-container>
            <ng-container matColumnDef="volume">
                <th mat-header-cell *matHeaderCellDef>Menge (ml)</th>
                <td mat-cell *matCellDef="let drink" style="width: 1%;">
                    <mat-form-field appearance="outline" class="compact-field small-input">
                        <input matInput type="number" [(ngModel)]="drink.volume" (ngModelChange)="calculateDrink(drink)"
                            min="0" step="10" placeholder="500">
                    </mat-form-field>
                </td>
            </ng-container>
            <ng-container matColumnDef="alcoholPercentage">
                <th mat-header-cell *matHeaderCellDef>Alkohol (%)</th>
                <td mat-cell *matCellDef="let drink" style="width: 1%;">
                    <mat-form-field appearance="outline" class="compact-field small-input">
                        <input matInput type="number" [(ngModel)]="drink.alcoholPercentage"
                            (ngModelChange)="calculateDrink(drink)" min="0" max="100" step="0.1" placeholder="5.0">
                    </mat-form-field>
                </td>
            </ng-container>
            <ng-container matColumnDef="time">
                <th mat-header-cell *matHeaderCellDef>Uhrzeit</th>
                <td mat-cell *matCellDef="let drink" style="width: 1%;">
                    <mat-form-field appearance="outline" class="compact-field small-input">
                        <input matInput type="time" [(ngModel)]="drink.time" (ngModelChange)="onDrinkChange(drink)">
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="alcoholGrams">
                <th mat-header-cell *matHeaderCellDef class="calculated-header">Alkohol (g)</th>
                <td mat-cell *matCellDef="let drink" class="calculated-cell">
                    {{drink.alcoholGrams | number:'1.1-1'}}
                </td>
            </ng-container>
            <ng-container matColumnDef="bacIncrease">
                <th mat-header-cell *matHeaderCellDef class="calculated-header highlight-header">BAC-Anstieg (‰)</th>
                <td mat-cell *matCellDef="let drink" class="calculated-cell highlight-cell bac-cell">
                    <span> {{drink.bacIncrease | number:'1.2-2'}} </span>
                    <mat-icon class="delete-icon" *ngIf="isDrinkComplete(drink)" (click)="removeDrink(drink)" title="Getränk entfernen">close</mat-icon>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.empty-row]="!isDrinkComplete(row)" class="table-row"></tr>
        </table>
    </div>

    <div class="current-bac">
        <div class="bac-display">
            <h3>Geschätzter aktueller Alkoholspiegel</h3>
            <div class="bac-value" [ngClass]="{'warning': currentBAC >= 0.5, 'danger': currentBAC >= 1.1}">
                {{currentBAC | number:'1.2-2'}} ‰
            </div>
        </div>
    </div>
</div>