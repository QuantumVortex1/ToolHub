<div class="component-wrapper">
  <div class="header-section">
    <h2>Kassen-Zählhilfe</h2>
    
    <div class="currency-selection">
      <mat-form-field appearance="outline" class="currency-field small-input">
        <mat-label>Währung</mat-label>
        <mat-select [value]="checkoutData.selectedCurrency.code" (selectionChange)="onCurrencyChange($event.value)">
          <mat-option *ngFor="let currency of availableCurrencies" [value]="currency.code">
            {{ currency.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <div class="cash-tables-container">
    <div class="cash-table-section">
      <h3>Scheine</h3>
      <table class="cash-table notes-table">
        <thead>
          <tr>
            <th>Wert</th>
            <th>Anzahl</th>
            <th>Summe</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cashCount of notes" class="cash-row">
            <td class="denomination-cell">
              <div class="denomination-badge note-badge" [style.background-color]="cashCount.denomination.color">
                {{ cashCount.denomination.value }}{{ checkoutData.selectedCurrency.symbol }}
              </div>
            </td>
            <td class="count-cell">
              <mat-form-field appearance="outline" class="count-field small-input">
                <input 
                  matInput 
                  type="number" 
                  [(ngModel)]="cashCount.count" 
                  (ngModelChange)="onCountChange(cashCount)"
                  min="0" 
                  step="1"
                  placeholder="0">
              </mat-form-field>
            </td>
            <td class="total-cell">
              {{ cashCount.total.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="cash-table-section">
      <h3>Münzen</h3>
      <table class="cash-table coins-table">
        <thead>
          <tr>
            <th>Wert</th>
            <th>Anzahl</th>
            <th>Summe</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cashCount of coins" class="cash-row">
            <td class="denomination-cell">
              <div class="denomination-badge coin-badge" [style.background-color]="cashCount.denomination.color">
                {{ cashCount.denomination.value }}{{ checkoutData.selectedCurrency.symbol }}
              </div>
            </td>
            <td class="count-cell">
              <mat-form-field appearance="outline" class="count-field small-input">
                <input 
                  matInput 
                  type="number" 
                  [(ngModel)]="cashCount.count" 
                  (ngModelChange)="onCountChange(cashCount)"
                  min="0" 
                  step="1"
                  placeholder="0">
              </mat-form-field>
            </td>
            <td class="total-cell">
              {{ cashCount.total.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="additional-inputs">
    <div class="positive-inputs-section">
      <h4 class="section-title positive-title">Zusätzliche Einnahmen</h4>
      <div class="input-grid positive-inputs">
        <mat-form-field appearance="outline" class="additional-field small-input">
          <mat-label>Münzrollen ({{ checkoutData.selectedCurrency.symbol }})</mat-label>
          <input 
            matInput 
            type="number" 
            [(ngModel)]="checkoutData.coinRolls" 
            (ngModelChange)="onAdditionalCashChange()"
            min="0" 
            step="0.01"
            placeholder="0.00">
        </mat-form-field>

        <mat-form-field appearance="outline" class="additional-field small-input">
          <mat-label>Belege ({{ checkoutData.selectedCurrency.symbol }})</mat-label>
          <input 
            matInput 
            type="number" 
            [(ngModel)]="checkoutData.receipts" 
            (ngModelChange)="onAdditionalCashChange()"
            min="0" 
            step="0.01"
            placeholder="0.00">
        </mat-form-field>

        <mat-form-field appearance="outline" class="additional-field small-input">
          <mat-label>Kartenzahlungen ({{ checkoutData.selectedCurrency.symbol }})</mat-label>
          <input 
            matInput 
            type="number" 
            [(ngModel)]="checkoutData.cardPayments" 
            (ngModelChange)="onAdditionalCashChange()"
            min="0" 
            step="0.01"
            placeholder="0.00">
        </mat-form-field>
      </div>
    </div>

    <div class="negative-inputs-section">
      <h4 class="section-title negative-title">Abzug</h4>
      <div class="input-grid negative-inputs">
        <mat-form-field appearance="outline" class="additional-field small-input starting-cash-field">
          <mat-label>Anfangsgeld abziehen ({{ checkoutData.selectedCurrency.symbol }})</mat-label>
          <input 
            matInput 
            type="number" 
            [(ngModel)]="checkoutData.startingCash" 
            (ngModelChange)="onAdditionalCashChange()"
            min="0" 
            step="0.01"
            placeholder="0.00">
        </mat-form-field>
      </div>
    </div>
  </div>

  <div class="result-section">
    <div class="result-card">
      <div class="result-row">
        <span class="result-label">Bargeld (Scheine + Münzen):</span>
        <span class="result-value">{{ (checkoutData.totalCash - (checkoutData.coinRolls || 0) - (checkoutData.receipts || 0) - (checkoutData.cardPayments || 0)).toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}</span>
      </div>
      <div class="result-row" *ngIf="checkoutData.coinRolls">
        <span class="result-label">+ Münzrollen:</span>
        <span class="result-value">{{ checkoutData.coinRolls.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}</span>
      </div>
      <div class="result-row" *ngIf="checkoutData.receipts">
        <span class="result-label">+ Belege:</span>
        <span class="result-value">{{ checkoutData.receipts.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}</span>
      </div>
      <div class="result-row" *ngIf="checkoutData.cardPayments">
        <span class="result-label">+ Kartenzahlungen:</span>
        <span class="result-value">{{ checkoutData.cardPayments.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}</span>
      </div>
      <div class="result-divider"></div>
      <div class="result-row subtotal">
        <span class="result-label">Gesamtumsatz:</span>
        <span class="result-value">{{ checkoutData.totalCash.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}</span>
      </div>
      <div class="result-row" *ngIf="checkoutData.startingCash">
        <span class="result-label">- Anfangsgeld:</span>
        <span class="result-value negative">{{ checkoutData.startingCash.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}</span>
      </div>
      <div class="result-divider"></div>
      <div class="result-row final">
        <span class="result-label">Endresultat:</span>
        <span class="result-value final-amount" [class.negative]="checkoutData.finalAmount < 0">
          {{ checkoutData.finalAmount.toFixed(2) }}{{ checkoutData.selectedCurrency.symbol }}
        </span>
      </div>
    </div>

    <div class="actions">
      <button mat-raised-button color="primary" (click)="exportToPDF()" class="export-button">
        <mat-icon>picture_as_pdf</mat-icon>
        Als PDF speichern
      </button>
      
      <button mat-stroked-button color="warn" (click)="resetData()">
        <mat-icon>refresh</mat-icon>
        Zurücksetzen
      </button>
    </div>
  </div>
</div>